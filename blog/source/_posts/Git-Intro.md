---
title: Git学习笔记
categories: 笔记
date: 2021-01-05 16:01:03
updated: 2021-01-05 16:01:03
tags:
---


-----

在软件的开发过程中，版本控制是一件极为重要的事---因为软件的开发不是一蹴而就的，是一个不断迭代的过程。在迭代的过程中，软件的每个版本都会增删功能，版本控制所要做的就是如实的备份每个版本，记录每个版本的功能以及是谁编写的某部分代码。在诸多现代版本控制系统(VCSs)中，Git是其中最为常见的一个标准。

<!--more-->

从第一次接触Git到现在已经三四年，但之前一直只是机械的记住命令来使用，没有更深入的了解。直到最近才开始逐渐了解Git背后的机理，并在此对学习进行一个总结。

## Git的数据存储

### 快照

我们存储的数据中，一种是文件(Blob对象)，就是我们的代码、文档和数据等等，另一种是用来描述文件之间关系的对象，即目录(Tree对象)。需要注意的是，这两者都是我们的原始数据，至此还未涉及Git的结构。

一般我们将目录的最顶端，即树的根，称作一个快照。通过一个快照，我们可以定位一组完整的文件。在使用Git时，我们一般会将一组完整的文件进行一次提交，交给Git进行管理，故对于Git来说，快照和提交是可以互换的说法。

### 关联快照

接下里Git要做的，就是将一次次的提交关联起来。Git中，提交们组成了一个“有向无环图”。无需在意这个名称的严格定义，只需要知道，这个结构保证了我们在回溯开发历史时，可以找到任意一个版本是由哪个版本修改而来。下图是一个用ASCII符号构建的有向无环图的例子：

```
O <- O <- O <- O <- O <- O <- O
          ^            /
           \          v
            O <- O <- O <- O
```

如上图所示，每个"O"代表一次提交，箭头指向的是每个提交的“父辈”，同时沿着图的方向，不会出现任何的循环。当一个提交有多个“父辈”时，表示它由这两个提交merge得到。

### 引用

在搭建这个图时，Git并不会将每个文件完整的储存下来，而是只存储文件的Hash之和。当我们需要调用某个提交时，可以通过这个Hash值索引到我们需要的文件。为了方便人们记忆，我们为Hash值起了一个对人类来说可读的名字(例如master等)，这个名字就是引用。

同时我们也需要知道当前我们所在的是哪个提交，故在我们当前的位置处，有一个特殊的引用，叫做“Head”。作用上类似与C语言中的指针。

### 数据存储总结

在Git的硬盘上，真正被存储的文件分为两类，一类是我们的原始数据，另一类就是引用。Git几乎不会删除文件，在我们提交之后，Git会创建一个引用，放在Head引用之后。

当我们创建一个分支时，只是创建了一个新的特殊引用，如NewFeature，指向某个我们指定的引用,如Old，并将之后新提交所对应的引用放在NewFeature之后。

```
O <- O <- Old <- O <- O <- O <- O
           ^          
            \          
             NewFeature <- O <- O 
```

## 暂存区

暂存区是一个比较特殊的概念，它与Git如何存储数据无关，但在每次提交时都会用到。它的用处就像是海关，告诉git本次提交的是哪些文件。

在提交时，最简单的方法是把所有的文件都一股脑的提交给git，这种情形下并不需要暂存区，因为这时本地文件与提交没有任何区别。但当我们在对文件的多个部分分别进行修改，且各个部分之间进度不一时，我们就需要将哪些需要提交，哪些不需要现在提交区分开来，这时就需要暂存区。

## 工作区、本地仓库与远程仓库

在实际工作中，我们通常会将完成的部分放在仓库，正在修改的部分放在工作区，以免混乱。同时我们也会在远程仓库做备份，便于分享。

三者之间的关系以及常用操作如下图：

![](WorkSpace.jpg)



## 常用Git命令

1. git init: 初始化一个本地的git仓库，所有的信息会放在.git目录下。

2. git add: 将文件加入暂存区

   --- git add . :将目前目录下所有文件加入暂存区

3. git reset HEAD <filename>: 将文件从暂存区删除

4. git commit: 将暂存区的文件进行提交，同时进行引用的命名。

   --- git commit -m "message": Message处可以直接写commit id

5. git checkout branch: 切换到branch分支。PS:这会直接将branch分支恢复到与库一致。也可用来恢复到最新一次提交的状态。

6. git branch: 显示所有分支

   --- git branch <branch name>: 创建一个新的branch

7. git merge <branch>: 将branch合并到目前的分支

8. git push <remote name> <local branch>:<remote branch>:将local branch推到remote上的remote branch并更新remote上的引用



## Reference

1. https://missing-semester-cn.github.io/2020/version-control/
2. https://git-scm.com/book/zh/v2/%E8%B5%B7%E6%AD%A5-Git-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F